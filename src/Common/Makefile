#
# Makefile for libCommon.a - a collection of common library functions
#
# Paul Houghton - 09/03/93 11:39 
#
# See End of file for modification log
#
# $Id$
#


include make.cfg


BETA_LIB_DEST	= /usr/local/lib/beta
BETA_INC_DEST	= /usr/local/include/beta

PROD_LIB_DEST	= /usr/local/lib
PROD_INC_DEST	= /usr/local/include

LIBRARY = libCommon.a

USER_INCS	= Common.h avl.h DateTime.h

PROTO_H = _CommonProto.h

# **** S O U R C E   F I L E S ****

LIB_C_SOURCES   =   	\
	ArgEnvInt.c	\
	ArgEnvBool.c	\
	ArgEnvString.c	\
	ErrorString.c	\
	strlwr.c	\
	strupr.c	\
	LibError.c	\
	_ArgString.c	\
	CommonGetVersion.c \
	CenterLine.c	\
	Difftm.c	\
	ForeachFile.c	\
	avl.c           \
	StripSpaces.c	\
	StringToInt.c   \
    	StringToLong.c	\
	SetErrorHandler.c \
	YYMMDDtoTimeT.c \
	HHMMSStoTimeT.c \
	DateTimeData.c  \
    	LoggerInit.c    \
	Logger.c	\
	LogLevelFromString.c \
	LogLevelString.c \
	LoggerTrim.c    \
    	LoggerLoc.c     \
    	_LoggerFileName.c \
	$(ARCH_C_SOURCES)


ifeq ($(arch),NeXT)
  ARCH_C_SOURCES  = strdup.c
endif


# *****  D E F I N E S  *****

DEFINES		= -D_POSIX_SOURCE

# *****  I N C L U D E S *****

TOPDIR		= .

SRCINCDIR	= -I.
PRJINCDIR	= -I$(TOPDIR)

INCDIRS		= $(SRCINCDIR)	\
		  $(PRJINCDIR)


# **** C O M P I L E / C P P ****

CPPOTHER 	=
CCDEBUG		= -pg
#CCDEBUG		= -Q -O3
CCOTHER		=

# ***** L I B R A R I E S *****

LDLIBDIRS	=
LDLIBS		=



# ***** D E P E N D A N C I E S *****



all: $(PROTO_H) $(LIBRARY)



$(LIBRARY): $(LIB_OBJECTS)
	$(UPDATELIB) $@ $?

.depend:
	touch .depend
	cproto -p $(LIB_C_SOURCES) >$(PROTO_H)
	$(DEPEND) -f.depend -- $(CPPFLAGS) -- $(LIB_C_SOURCES)
	sed  's/^\([^ 	].*o:.*\)$(PROTO_H)\(.*\)/\1\2/' .depend >dep.out
	mv dep.out .depend

depend:
	touch .depend
	cproto -p $(LIB_C_SOURCES) >$(PROTO_H)
	$(DEPEND) -f.depend -- $(CPPFLAGS) -- $(LIB_C_SOURCES)
	sed  's/^\([^ 	].*o:.*\)$(PROTO_H)\(.*\)/\1\2/' .depend >dep.out
	mv dep.out .depend


test:

clean:
	rm -f $(LIBRARY) $(LIB_OBJECTS) $(PROTO_H)
	
install:
	-( cd $(BETA_LIB_DEST); cp $(LIBRARY) old )
	-( cd $(BETA_INC_DEST); cp $(USER_INCS) old )
	cp $(LIBRARY) $(BETA_LIB_DEST)
	chmod 664 $(BETA_LIB_DEST)/$(LIBRARY)
	chgrp tools $(BETA_LIB_DEST)/$(LIBRARY)
	cp $(USER_INCS) $(BETA_INC_DEST)
	(cd $(BETA_INC_DEST); chmod 664 $(USER_INCS) )
	(cd $(BETA_INC_DEST); chgrp tools $(USER_INCS) )
	@echo 'Beta Install Complete!'
	
install_production:
	-( cd $(PROD_LIB_DEST); cp $(LIBRARY) old )
	-( cd $(PROD_INC_DEST); cp $(USER_INCS) old )
	cp $(LIBRARY) $(PROD_LIB_DEST)
	chmod 664 $(PROD_LIB_DEST)/$(LIBRARY)
	chgrp tools $(PROD_LIB_DEST)/$(LIBRARY)
	cp $(USER_INCS) $(PROD_INC_DEST)
	(cd $(PROD_INC_DEST); chmod 664 $(USER_INCS) )
	(cd $(PROD_INC_DEST); chgrp tools $(USER_INCS) )
	echo 'Production Install Complete!'

$(PROTO_H): $(LIB_C_SOURCES)
	cproto $(CPPFLAGS) $(LIB_C_SOURCES) >$@
	

tags: 
	etags *.h *.c

#
# include dependancies generated by 'make depend'
#
include .depend


#
# $log:$
#
